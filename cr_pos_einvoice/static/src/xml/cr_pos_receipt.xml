<?xml version="1.0" encoding="UTF-8"?>
<templates id="template" xml:space="preserve">

    <!-- Enterprise-safe extension: augment native ticket only with FE metadata. -->
    <t t-inherit="point_of_sale.OrderReceipt" t-inherit-mode="extension">
        <xpath expr="//div[hasclass('pos-receipt')]" position="inside">
            <t t-set="data" t-value="(props &amp;&amp; (props.data || props.receipt || props.order_receipt || props.orderReceipt || props)) || {}"/>
            <t t-set="einvoice" t-value="(data &amp;&amp; data.einvoice) || {}"/>

            <div class="cr-fe-extra">
                <div class="cr-divider"/>

                <div class="cr-center cr-doc-type">
                    <t t-set="dtype" t-value="einvoice.document_type || ''"/>
                    <strong>Tipo de comprobante:</strong>
                    <t t-if="dtype == 'te'"> Tiquete electrónico</t>
                    <t t-elif="dtype == 'fe'"> Factura electrónica</t>
                    <t t-elif="dtype == 'nc'"> Nota de crédito electrónica</t>
                    <t t-elif="dtype == 'nd'"> Nota de débito electrónica</t>
                    <t t-else=""> Comprobante</t>
                </div>

                <t t-set="consec" t-value="einvoice.consecutivo || ''"/>
                <div class="cr-center cr-small">
                    <strong>Consecutivo:</strong>
                    <t t-if="consec"><t t-esc="consec"/></t>
                    <t t-else="">Pendiente</t>
                </div>

                <div class="cr-block">
                    <div class="cr-title">Clave</div>
                    <t t-if="einvoice.clave">
                        <div class="cr-mono cr-wrap"><t t-esc="einvoice.clave"/></div>
                    </t>
                    <t t-else="">
                        <div class="cr-small">Pendiente</div>
                    </t>
                </div>

                <div class="cr-divider"/>
                <div class="cr-center cr-small">
                    <t t-esc="(data.date &amp;&amp; data.date.localestring) || (data.date &amp;&amp; data.date) || ''"/>
                </div>

                <div style="text-align:center;margin-top:8px;" class="cr-fe-footer cr-small">
                    <div>Autorizado mediante la resolución MH-DGT-RES-0027-2024 del 13/11/2024 de la DGTD.</div>
                    <div>Versión XML 4.4</div>
                </div>
            </div>
        </xpath>
    </t>

</templates>
