<?xml version="1.0" encoding="UTF-8"?>
<templates id="template" xml:space="preserve">

    <!-- Enterprise-safe extension: augment native ticket only with FE metadata. -->
    <t t-inherit="point_of_sale.OrderReceipt" t-inherit-mode="extension">
        <xpath expr="//div[hasclass('pos-receipt')]" position="inside">
            <t t-set="data" t-value="(props &amp;&amp; (props.data || props.receipt || props.order_receipt || props.orderReceipt || props)) || {}"/>
            <t t-set="einvoice" t-value="(data &amp;&amp; data.einvoice) || {}"/>
            <t t-set="partner" t-value="(data &amp;&amp; data.partner) || {}"/>

            <div class="cr-fe-extra">
                <t t-if="data.orderlines &amp;&amp; data.orderlines.length">
                    <div class="cr-lines-head cr-small">
                        <span class="cr-col-qty">Cant</span>
                        <span class="cr-col-desc">Descripción</span>
                        <span class="cr-col-amt cr-right">Importe</span>
                    </div>
                </t>

                <div class="cr-divider"/>

                <t t-if="partner.name || partner.vat || partner.email || partner.phone || einvoice.receptor_id">
                    <div class="cr-block cr-small">
                        <div class="cr-title">Datos del receptor</div>
                        <div t-if="partner.name"><strong>Nombre:</strong> <t t-esc="partner.name"/></div>
                        <div t-if="partner.vat || einvoice.receptor_id">
                            <strong>Identificación:</strong> <t t-esc="partner.vat || einvoice.receptor_id"/>
                        </div>
                        <div t-if="partner.email"><strong>Correo:</strong> <t t-esc="partner.email"/></div>
                        <div t-if="partner.phone"><strong>Teléfono:</strong> <t t-esc="partner.phone"/></div>
                    </div>
                    <div class="cr-divider"/>
                </t>

                <div class="cr-block cr-small">
                    <div><strong>Tipo de comprobante:</strong> <t t-esc="einvoice.document_type || data.cr_fe_document_type || 'Comprobante'"/></div>
                    <div><strong>Consecutivo:</strong> <t t-esc="einvoice.consecutivo || data.cr_fe_consecutivo || 'Pendiente'"/></div>
                    <div>
                        <strong>Clave:</strong>
                        <span class="cr-mono cr-wrap"><t t-esc="einvoice.clave || data.cr_fe_clave || 'Pendiente'"/></span>
                    </div>
                </div>

                <div class="cr-divider"/>
                <div class="cr-center cr-small">
                    <t t-esc="(data.date &amp;&amp; data.date.localestring) || (data.date &amp;&amp; data.date) || ''"/>
                </div>

                <div style="text-align:center;margin-top:8px;" class="cr-fe-footer cr-small">
                    <div>Autorizado mediante la resolución MH-DGT-RES-0027-2024 del 13/11/2024 de la DGTD.</div>
                    <div>Versión XML 4.4</div>
                </div>
            </div>
        </xpath>
    </t>

</templates>
