<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="view_pos_order_tree_cr_hacienda" model="ir.ui.view">
        <field name="name">pos.order.tree.cr.hacienda</field>
        <field name="model">pos.order</field>
        <field name="arch" type="xml">
            <list string="Comprobantes electrónicos POS" create="0" delete="0">
                <field name="date_order" string="Fecha emisión"/>
                <field name="name" string="Factura"/>
                <field name="partner_id" string="Cliente" optional="show"/>
                <field name="fp_document_type" string="Tipo de comprobante" optional="show"/>
                <field name="fp_sale_condition" string="Condición de venta" optional="show"/>
                <field name="fp_payment_method" string="Medio de pago" optional="show"/>
                <field name="cr_fe_clave" string="Clave" optional="show"/>
                <field name="cr_fe_consecutivo" string="Consecutivo" optional="show"/>
                <field name="cr_fe_status" string="Estado Hacienda" widget="badge" decoration-success="cr_fe_status == 'accepted'" decoration-danger="cr_fe_status in ('rejected', 'error')" decoration-warning="cr_fe_status in ('pending', 'processing', 'sent', 'error_retry')"/>
                <field name="amount_total" sum="Total"/>
                <field name="company_id" groups="base.group_multi_company"/>
            </list>
        </field>
    </record>

    <record id="view_pos_order_form_cr_hacienda" model="ir.ui.view">
        <field name="name">pos.order.form.cr.hacienda</field>
        <field name="model">pos.order</field>
        <field name="arch" type="xml">
            <form string="Comprobantes electrónicos POS" create="0" delete="0">
                <header>
                    <button
                        name="action_cr_send_hacienda"
                        type="object"
                        string="Enviar a Hacienda"
                        class="btn-primary"
                        invisible="state not in ['paid', 'done', 'invoiced'] or cr_fe_status in ['accepted', 'rejected', 'not_applicable']"
                    />
                    <button
                        name="action_cr_check_hacienda_status"
                        type="object"
                        string="Consultar estado Hacienda"
                        invisible="cr_fe_status not in ['sent', 'processing', 'pending', 'error_retry']"
                    />
                    <button name="action_cr_open_fe_document" type="object" string="Abrir comprobante electrónico"/>
                    <field name="cr_fe_status" widget="statusbar" statusbar_visible="draft,pending,error_retry,sent,processing,accepted,rejected,error,not_applicable"/>
                </header>
                <sheet>
                    <group>
                        <group>
                            <field name="cr_fe_clave" readonly="1"/>
                            <field name="cr_fe_consecutivo" readonly="1"/>
                            <field name="name" string="Factura" readonly="1"/>
                            <field name="fp_document_type" string="Tipo de comprobante" readonly="1"/>
                            <field name="partner_id" string="Cliente" readonly="1"/>
                            <field name="date_order" string="Fecha emisión" readonly="1"/>
                            <field name="fp_sale_condition" string="Condición de venta" readonly="1"/>
                            <field name="currency_id" readonly="1"/>
                        </group>
                        <group>
                            <field name="company_id" string="Empresa" readonly="1"/>
                            <field name="fp_economic_activity_id" string="Actividad económica" readonly="1"/>
                            <field name="fp_payment_method" string="Medio de pago" readonly="1"/>
                            <field name="amount_tax" string="Impuesto" readonly="1"/>
                            <field name="amount_total" string="Importe total" readonly="1"/>
                            <field name="state" string="Estado contable" readonly="1"/>
                            <field name="account_move" string="Factura contable" readonly="1"/>
                            <field name="cr_ticket_move_id" string="Tiquete contable" readonly="1"/>
                        </group>
                    </group>
                    <group string="Adjuntos XML">
                        <field name="cr_fe_xml_attachment_id" string="Archivo XML" readonly="1"/>
                        <field name="cr_fe_response_attachment_id" string="Archivo XML MH" readonly="1"/>
                    </group>
                    <group string="Diagnóstico FE">
                        <field name="cr_fe_error_code" readonly="1"/>
                        <field name="cr_fe_last_error" readonly="1"/>
                        <field name="cr_fe_retry_count" readonly="1"/>
                        <field name="cr_fe_last_send_date" readonly="1"/>
                        <field name="cr_fe_idempotency_key" readonly="1"/>
                    </group>
                </sheet>
            </form>
        </field>
    </record>

    <record id="action_cr_hacienda_comprobantes_pos" model="ir.actions.act_window">
        <field name="name">Comprobantes POS</field>
        <field name="res_model">pos.order</field>
        <field name="view_mode">list,form</field>
        <field name="view_id" ref="view_pos_order_tree_cr_hacienda"/>
        <field name="domain">[('state', 'in', ['paid', 'done', 'invoiced'])]</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">No hay comprobantes POS todavía.</p>
            <p>En este menú se listan los comprobantes electrónicos generados desde órdenes de POS.</p>
        </field>
    </record>

    <menuitem
        id="menu_cr_hacienda_comprobantes_pos"
        name="Comprobantes POS"
        parent="point_of_sale.menu_point_config_product"
        action="action_cr_hacienda_comprobantes_pos"
        sequence="80"
    />
</odoo>
